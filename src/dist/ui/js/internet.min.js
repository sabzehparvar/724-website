"use strict";$(document).ready(function(){let e;function t(e){$(".ui-card-wizard").hide(),$(`.ui-card-wizard[data-wizard="${e}"]`).fadeIn()}function a(){let e=hasValue($("#InternetOperator").val())?$("#InternetOperator").val().trim():null,a=hasValue($("#InternetSimType").val())?$("#InternetSimType").val().trim():1,n=hasValue($("#InternetDuration").val())?$("#InternetDuration").val().trim():4,l=hasValue($("#InternetPackage ul").attr("data-operator"))?$("#InternetPackage ul").attr("data-operator").trim():null,i=hasValue($("#InternetSimTypeList ul").attr("data-type"))?$("#InternetSimTypeList ul").attr("data-type").trim():1,o=hasValue($("#InternetDurationList ul").attr("data-duration"))?$("#InternetDurationList ul").attr("data-duration").trim():null;e&&(l!=e||i!=a||o!=n)&&ajaxHandler(asmxUrl+"/controllers//eChargeController.asmx/getInternetPackages","GET",{chargeOperatorCode:e,simCardType:a,durationType:n},null,function(l){if(hasValue(l)&&l.hasOwnProperty("d")){if(hasValue(l.d)){let i=l.d,o={};i.forEach(e=>{o[e.Duration]||(o[e.Duration]=[]),o[e.Duration].push(e)});let u=Object.keys(o).map(Number).sort((e,t)=>e-t),s="";u.forEach(t=>{let a=`${t} ${durationTypes[n]}`;s+=`<li class="uk-disabled"><div class="uk-padding-small">${a}</div></li>`,o[t].sort(r).forEach(t=>{if(hasValue(t.Amount)){let a="./dist/ui/img/icon/app/"+operatorIcons[e]+".svg";s+=$("#InternetPackages").html().replace("%Operator%",e).replace("%IconSrc%",a).replaceAll("%Name%",operatorTypes[e]).replaceAll("%Code%",t.SepChargeCode).replace("%OperatorName%",operatorTypes[e]).replace("%Duration%",t.Duration).replace("%DurationType%",durationTypes[t.DurationType]).replaceAll("%Description%",t.Description).replaceAll("%Amount%",commaSeparator(t.Amount)).replace("%ChargeAmount%",t.Amount)}})}),$("#InternetPackageList ul").empty().append(s).attr("data-operator",e).attr("data-type",a).attr("data-duration",n),$("#BuyInternetPackageButton").removeClass("uk-hidden")}else $("#InternetPackageList ul").removeAttr("data-operator data-type data-duration").empty().append($("#EmptyInternet").html()),$("#BuyInternetPackageButton").addClass("uk-hidden");t("second-card")}else UIkit.notification(langs.serviceException,{status:"danger",pos:"bottom-center",timeout:7e3})},!0)}function r(e,t){var a=e.duration,r=t.duration;return a<r?-1:a>r?1:0}function n(){$("#InternetOperator").parents().find("a").removeClass("ui-active-operator")}$.validator.addMethod("cellNumber",function(e,t){return this.optional(t)||validateCellNumber(e)},validationMessage.cellNumber),$.validator.addMethod("mciPostPaidNumber",function(e,t){return this.optional(t)||validateMciPostPaidNumber(e)},validationMessage.mciPostPaidNumbers),$.validator.setDefaults({errorElement:"div",errorClass:"uk-text-danger uk-text-small uk-margin-small-top",ignore:".ignore",onkeyup:function(e){this.element(e)},highlight:function(e){$(e).addClass("uk-form-danger")},unhighlight:function(e){$(e).removeClass("uk-form-danger")},errorPlacement:function(e,t){e.appendTo(t.closest("div"))}}),document.getElementById("InternetPackageForm")&&(ajaxHandler(asmxUrl+"/controllers/eChargeController.asmx/getOperators","GET",null,null,function(e){if(hasValue(e)&&e.hasOwnProperty("d")&&hasValue(e.d)){let t="";$.each(e.d,function(e,a){let r="./dist/ui/img/icon/operators/"+operatorIcons[a.Code]+".svg";t+=$("#InternetOperators").html().replace("%Code%",a.Code).replace("%IconSrc%",r).replaceAll("%Name%",a.Description)}),$("#InternetOperator ul").empty().append(t),ajaxHandler(asmxUrl+"/controllers/eChargeController.asmx/getSimCardTypes","GET",null,null,function(e){if(hasValue(e)&&e.hasOwnProperty("d")&&hasValue(e.d)){let t=e.d,a="";$.each(t,function(e,t){var r=1==t.Code?"uk-active":"";a+=$("#SimTypes").html().replace("%Class%",r).replaceAll("%Code%",t.Code).replace("%Name%",t.Description)}),$("#InternetSimTypeList").removeClass("uk-hidden"),$("#InternetSimTypeList ul").empty().append(a),$("button[data-action='getInternetPackages']").removeClass("uk-hidden")}else $("#InternetSimTypeList").removeClass("uk-hidden").empty().append($("#ServiceError").html())},!0)}else $("#InternetOperator").empty().append($("#ServiceError").html())},!0),$("#InternetPackageForm").validate({rules:{CellNumber:{digits:!0,cellNumber:!0}}}),$("#InternetPackageForm #CellNumber").keyup(function(t){let a=normalize($(this).val());if(a.length>=4){if(e=validateCellNumber(a,!0)){let r=$("#InternetOperator").children().find("[data-value="+e+"]");r.hasClass("ui-active-operator")||($("#InternetOperator").val(e),n(),r.addClass("ui-active-operator"))}}else a.length<4&&($("#InternetOperator").val(""),n(),$("#InternetPackageList ul").empty())})),$(document).on("click",".uk-button, .uk-link",function(e){if(!$(this).hasClass("on-progress")){let r=$(this),l=hasValue($(this).attr("data-action"))?$(this).attr("data-action").trim():null;if(l){let i=hasValue($("#CellNumber").val())?normalize($("#CellNumber").val().trim()):null;switch(l){case"changeInternetOperator":if($("#InternetPackageForm").valid())n(),r.addClass("ui-active-operator"),$("#InternetOperator").val(hasValue($(this).attr("data-value"))?$(this).attr("data-value").trim():null);else if(!i||!validateCellNumber(i))return UIkit.notification(i?langs.invalidCellNumber:langs.requiredCellNumber,{status:"primary",pos:"bottom-center",timeout:7e3}),!1;e.preventDefault();break;case"changeInternetType":$("#InternetSimType").val(hasValue($(this).attr("data-value"))?$(this).attr("data-value").trim():null),e.preventDefault();break;case"changeInternetDuration":$("#InternetDuration").val(hasValue($(this).attr("data-value"))?$(this).attr("data-value").trim():null),a(),e.preventDefault();break;case"buyInternetPackage":{let o=null,u=null,s=0,c=null,d=document.querySelectorAll("#InternetPackageItem");for(let p of d)if(p.classList.contains("uk-active")){o=hasValue(p.getAttribute("data-operator"))?p.getAttribute("data-operator"):null,u=hasValue(p.getAttribute("data-charge"))?p.getAttribute("data-charge"):null,s=hasValue(p.getAttribute("data-amount"))?normalize(p.getAttribute("data-amount")):null,c=hasValue(p.getAttribute("data-text"))?p.getAttribute("data-text"):null;break}if(o&&u&&c&&i&&s){let m={CellNumber:i,ChargeCode:u,ChargeOperatorCode:o,ChargeDescription:c,Amount:s,TopUpType:"InternetPackage",ThirdPartyCallBack:ThirdPartyCallBackUrl};ajaxHandler(asmxUrl+"/api/v1/ipg-top-up/get-token","GET",m,null,function(e){if(e&&e.IsSuccess&&e.Data){let{IpgUrl:t,GetMethod:a,Value:r,ResNum:n}=e.Data;$.redirect(t,{token:r,GetMethod:!0},"POST")}else UIkit.notification(langs.serviceException,{status:"danger",pos:"bottom-center",timeout:7e3})},!0,!0,!0)}else UIkit.notification(langs.selectingTopupPackage,{status:"danger",pos:"bottom-center",timeout:7e3});e.preventDefault();break}case"getInternetPackages":$("#InternetPackageForm").valid()&&ajaxHandler(asmxUrl+"/controllers/eChargeController.asmx/getPackageDurationTypes","GET",null,null,function(e){if(hasValue(e)&&e.hasOwnProperty("d")&&hasValue(e.d)){let t=e.d,r="";$.each(t,function(e,t){let a=4==t.Code?"uk-active":"";r+=$("#InternetDurations").html().replace("%Class%",a).replaceAll("%Code%",t.Code).replace("%Duration%",t.Name).replace("%Name%",t.Description)}),$("#InternetDurationList ul").empty().append(r),a()}else UIkit.notification(langs.serviceException,{status:"danger",pos:"bottom-center",timeout:7e3})},!0),e.preventDefault();break;case"returnFirstCard":t("first-card"),$("#InternetDuration").val(""),$("#InternetPackageList ul").empty(),e.preventDefault()}}}})});