"use strict";$(document).ready(function(){function t(){$("#ReceiptContainer").empty().append($("#ReceiptErrorTemplate").html())}let e=new URLSearchParams(window.location.search),l=e.get("token"),a=e.get("resNum"),r=e.get("r"),i=e.get("tid");l&&a?ajaxHandler(asmxUrl+"/api/v1/ipg-top-up/get-receipt","GET",{token:l,resNum:a},null,function(e){if(hasValue(e=toCamel(e))&&e?.isSuccess&&e?.code===2e3&&hasValue(e?.data)){let l=e.data?.detail,a=e.data?.transaction,r=e.data?.topUpPackage;if(l){if(a&&r&&l?.topUpSuccess){!function t(e,l,a){let r={PackageFullTitle:hasValue(e.topUpDescription)?e.topUpDescription.trim():null,Amount:hasValue(e.amount)?e.amount:null,CellNumber:hasValue(e.cellNumber)?e.cellNumber.trim():null,OperatorName:hasValue(operatorTypes[e.operatorCode])?operatorTypes[e.operatorCode].trim():null,SecurePan:hasValue(l.securePan)?l.securePan.trim():null,PersianPayedOn:hasValue(l.persianPayedOn)?l.persianPayedOn.trim():null,TraceNo:hasValue(l.traceNo)?l.traceNo.trim():null,DurationType:a&&hasValue(a.durationType)?a.durationType:null,ChargeTypeDescription:a&&hasValue(a.chargeTypeDescription)?a.chargeTypeDescription:null},i=$("#SuccessReceiptTemplate").html(),u=$("<div>").html(i);u.find('p[data-field="PackageFullTitle"]').text(r?.PackageFullTitle||"-");let n=u.find(".ui-receipt-table table tbody");n.find("tr").not("#ReceiptAppDownload").remove(),[{key:"Amount",label:"مبلغ",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{},formatter:t=>commaSeparator(t)+" "+langs.irr},{key:"CellNumber",label:"برای شماره",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{dir:"ltr"}},{key:"OperatorName",label:"اپراتور",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{}},{key:"DurationType",label:"مدت",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{},formatter(t){let e=a.duration,l=durationTypes[t]||"";return e+" "+l}},{key:"ChargeTypeDescription",label:"نوع شارژ",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{},formatter(t){switch(t){case"Shoorangiz":return langs.topupExcitingPkg;case"Wow":return langs.topupAmazingPkg;case"Normal":return langs.topupNormalPkg;default:return null}}},{key:"SecurePan",label:"پرداخت با کارت",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{dir:"ltr"}},{key:"PersianPayedOn",label:"تاریخ و زمان",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{dir:"ltr"}},{key:"TraceNo",label:"شماره پیگیری",labelClass:"uk-text-muted uk-text-nowrap",valueClass:"uk-text-left",attrs:{dir:"ltr"}},].forEach(t=>{let e=r[t.key];if(null!=e){let l=t.formatter?t.formatter(e):e;if(null!=l){let a=$("<tr>");$("<td>").addClass(t.labelClass).text(t.label).appendTo(a);let i=$("<td>").addClass(t.valueClass).appendTo(a);Object.entries(t.attrs).forEach(([t,e])=>i.attr(t,e)),i.text(l),a.insertBefore(n.find("#ReceiptAppDownload"))}}}),$("#ReceiptContainer").empty().append(u.children())}(l,a,r);return}!function t(e){let l={PackageFullTitle:hasValue(e.topUpDescription)?e.topUpDescription.trim():null,Amount:hasValue(e.amount)?e.amount:null,CellNumber:hasValue(e.cellNumber)?e.cellNumber.trim():null},a=$("#FailedReceiptTemplate").html(),r=$("<div>").html(a);r.find('p[data-field="PackageFullTitle"]').text(l.PackageFullTitle||"-");let i=r.find(".ui-receipt-table table tbody");i.find("tr").not("#ReceiptAppDownload").remove(),[{key:"Amount",label:"مبلغ",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{},formatter:t=>commaSeparator(t)+" "+langs.irr},{key:"CellNumber",label:"برای شماره",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{dir:"ltr"}},].forEach(t=>{let e=l[t.key];if(null!=e){let a=$("<tr>");$("<td>").addClass(t.labelClass).text(t.label).appendTo(a);let r=$("<td>").addClass(t.valueClass).appendTo(a);Object.entries(t.attrs).forEach(([t,e])=>r.attr(t,e)),r.text(t.formatter?t.formatter(e):e),a.insertBefore(i.find("#ReceiptAppDownload"))}}),$("#ReceiptContainer").empty().append(r.children())}(l)}else t()}else t()},!0,!0,!0):r&&i?ajaxHandler(asmxUrl+"/api/v1/bill/get-receipt-by-tid","GET",{tid:i,resNum:r},null,function(e){if(hasValue(e=toCamel(e))&&e?.isSuccess&&e?.code===2e3&&hasValue(e?.data)){if("OK"===e.data[0].state){!function t(e){let l={PackageFullTitle:"پرداخت قبض موفق",Amount:hasValue(e.amount)?e.amount.toString().trim():null,PayId:hasValue(e.payId)?e.payId.toString().trim():null,BillId:hasValue(e.billId)?e.billId.toString().trim():null,TraceNo:hasValue(e.traceNo)?e.traceNo.toString().trim():null,Rrn:hasValue(e.rrn)?e.rrn.toString().trim():null,PayedOn:hasValue(e.payedOn)?parseInt(e.payedOn.toString().trim().replace(/\/Date\((\d+)\)\//,"$1"),10):null},a=$("#SuccessReceiptTemplate").html(),r=$("<div>").html(a);r.find('p[data-field="PackageFullTitle"]').text(l?.PackageFullTitle||"-");let i=r.find(".ui-receipt-table table tbody");i.find("tr").not("#ReceiptAppDownload").remove(),[{key:"Amount",label:"مبلغ",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{},formatter:t=>commaSeparator(t)+" "+langs.irr},{key:"PayedOn",label:"تاریخ و زمان",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{dir:"ltr"},formatter:t=>moment(t).format("jYYYY/jMM/jDD HH:mm")},{key:"BillId",label:"شناسه قبض",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{dir:"ltr"}},{key:"PayId",label:"شناسه پرداخت",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{dir:"ltr"}},{key:"TraceNo",label:"شماره پیگیری",labelClass:"uk-text-muted uk-text-nowrap",valueClass:"uk-text-left",attrs:{dir:"ltr"}},{key:"Rrn",label:"شماره مرجع",labelClass:"uk-text-muted uk-text-nowrap",valueClass:"uk-text-left",attrs:{dir:"ltr"}},].forEach(t=>{let e=l[t.key];if(null!=e){let a=t.formatter?t.formatter(e):e;if(null!=a){let r=$("<tr>");$("<td>").addClass(t.labelClass).text(t.label).appendTo(r);let u=$("<td>").addClass(t.valueClass).appendTo(r);Object.entries(t.attrs).forEach(([t,e])=>u.attr(t,e)),u.text(a),r.insertBefore(i.find("#ReceiptAppDownload"))}}}),$("#ReceiptContainer").empty().append(r.children())}(e.data[0]);return}if("Failed"===e.data[0].state){!function t(e){let l={PackageFullTitle:"پرداخت قبض ناموفق",Amount:hasValue(e.amount)?e.amount.toString().trim():null,PayId:hasValue(e.payId)?e.payId.toString().trim():null,BillId:hasValue(e.billId)?e.billId.toString().trim():null,TraceNo:hasValue(e.traceNo)?e.traceNo.toString().trim():null},a=$("#FailedReceiptTemplate").html(),r=$("<div>").html(a);r.find('p[data-field="PackageFullTitle"]').text(l.PackageFullTitle||"-");let i=r.find(".ui-receipt-table table tbody");i.find("tr").not("#ReceiptAppDownload").remove(),[{key:"Amount",label:"مبلغ",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{},formatter:t=>commaSeparator(t)+" "+langs.irr},{key:"BillId",label:"شناسه قبض",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{dir:"ltr"}},{key:"PayId",label:"شناسه پرداخت",labelClass:"uk-text-muted",valueClass:"uk-text-left",attrs:{dir:"ltr"}},{key:"TraceNo",label:"شماره پیگیری",labelClass:"uk-text-muted uk-text-nowrap",valueClass:"uk-text-left",attrs:{dir:"ltr"}},].forEach(t=>{let e=l[t.key];if(null!=e){let a=$("<tr>");$("<td>").addClass(t.labelClass).text(t.label).appendTo(a);let r=$("<td>").addClass(t.valueClass).appendTo(a);Object.entries(t.attrs).forEach(([t,e])=>r.attr(t,e)),r.text(t.formatter?t.formatter(e):e),a.insertBefore(i.find("#ReceiptAppDownload"))}}),$("#ReceiptContainer").empty().append(r.children())}(e.data[0]);return}}else t()},!0,!0,!0):t()});