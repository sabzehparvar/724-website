"use strict";$(document).ready(function(){let t="http://localhost:43197/api/v1/bill-inquiry";function e(t){$(".ui-card-wizard").hide(),$(`.ui-card-wizard[data-wizard="${t}"]`).fadeIn()}function a(t,e){let a={PaymentDate:hasValue(t.paymentDate)?moment(t.paymentDate,"MM/DD/YYYY HH:mm:ss",!0).isValid()?moment(t.paymentDate,"MM/DD/YYYY").locale("fa").format("YYYY/MM/DD"):t.paymentDate:null,CurrentDate:hasValue(t.currentDate)?moment(t.currentDate,"MM/DD/YYYY HH:mm:ss",!0).isValid()?moment(t.currentDate,"MM/DD/YYYY").locale("fa").format("YYYY/MM/DD"):t.currentDate:null,PreviousDate:hasValue(t.previousDate)?moment(t.previousDate,"MM/DD/YYYY HH:mm:ss",!0).isValid()?moment(t.previousDate,"MM/DD/YYYY").locale("fa").format("YYYY/MM/DD"):t.previousDate:null,PaymentId:hasValue(t.paymentID)?t.paymentID.toString().trim():null,PayId:hasValue(t.payId)?t.payId.toString().trim():null,Address:hasValue(t.address)?t.address.trim():null,BillCompany:hasValue(t.billCompany)?t.billCompany.trim():null},i=$("<table>").addClass("uk-table uk-table-divider uk-margin-remove-bottom uk-margin-top"),l=$("<tbody>").appendTo(i);[{key:"PayId",label:"شناسه پرداخت",labelClass:"uk-text-muted",valueClass:"uk-text-left fontface-vazir-fa",attrs:{dir:"ltr"}},{key:"PaymentId",label:"شناسه پرداخت",labelClass:"uk-text-muted",valueClass:"uk-text-left fontface-vazir-fa",attrs:{dir:"ltr"}},{key:"PaymentDate",label:"مهلت پرداخت",labelClass:"uk-text-muted ",valueClass:"uk-text-left fontface-vazir-fa",attrs:{dir:"ltr"}},{key:"CurrentDate",label:"تاریخ قرائت کنونی",labelClass:"uk-text-muted ",valueClass:"uk-text-left fontface-vazir-fa",attrs:{dir:"ltr"}},{key:"PreviousDate",label:"تاریخ قرائت پیشین",labelClass:"uk-text-muted ",valueClass:"uk-text-left fontface-vazir-fa",attrs:{dir:"ltr"}},{key:"Address",label:"آدرس",labelClass:"uk-text-muted",valueClass:"uk-text-left"},{key:"BillCompany",label:"شرکت",labelClass:"uk-text-muted",valueClass:"uk-text-left"}].forEach(t=>{let e=a[t.key];if(null!=e){let i=t.formatter?t.formatter(e):e;if(null!=i){let n=$("<tr>");$("<td>").addClass(t.labelClass).text(t.label).appendTo(n);let r=$("<td>").addClass(t.valueClass).appendTo(n);t.attrs&&Object.entries(t.attrs).forEach(([t,e])=>r.attr(t,e)),r.text(i),l.append(n)}}}),e.find(".ui-bills-details").empty().append(i)}function i(t,i){if(!t.hasOwnProperty("parameters")||!t.parameters.hasOwnProperty("amount"))return UIkit.notification(langs.requirementsError,{status:"danger",pos:"bottom-center",timeout:7e3}),!1;if(0==t.parameters.amount)return UIkit.notification(langs.noBillDebt,{status:"danger",pos:"bottom-center",timeout:7e3}),!1;let l=hasValue(i)?`قبض ${billTypesEnum[i]}`:"قبض",n=t?.parameters?.fullName?.trim()||"",r=t?.parameters?.billID?.toString().trim()||"",o=t?.parameters?.paymentID?.toString().trim()||"",d=t?.parameters?.amount?.toString().trim()+" "+langs.irr||"";$("#BillInfoTitle").text(`${l}`);let s=$($("#BillInfoTemplate").html());s.find("#BillName").text(`${l} ${n}`),s.find("#BillInfoId").text(`شناسه قبض: ${r}`),s.find("#BillAmount").text(commaSeparator(d)),s.find("#BillPayButton button").attr("data-billid",r).attr("data-payid",o),s.find(".ui-bill-amount-icon img").attr("src",`../dist/ui/img/icon/app/${billsIcons[i]}.svg`),$("#BillInfoContainer").html(s),a(t.parameters,s),e("third-card")}function l(t,a,i){let l=t?.parameters?.midTerm,n=t?.parameters?.finalTerm,r=!hasValue(l)&&!hasValue(n),o=l?.amount==0&&n?.amount==0;if(r||o)return UIkit.notification(langs.noBillDebt,{status:"danger",pos:"bottom-center",timeout:7e3}),!1;let d=hasValue(a)?`قبض ${billTypesEnum[a]}`:"قبض";$("#BillInfoTitle").text(d);let s=$($("#PhoneBillInfoTemplate").html());s.find("#BillName").text(d),s.find("#BillNumber").text(`شماره ${4==a?"تلفن":"موبایل"}: ${i}`),s.find(".ui-bill-amount-icon img").attr("src",`../dist/ui/img/icon/app/${billsIcons[a]}.svg`),s.find("#BillPayButton button").attr("data-billid",l?.billID||""),l?.amount&&l?.amount!=0?(s.find('label[for="MidTermInput"]').attr("data-payid",l?.paymentID||""),s.find("#MidTermInput").removeAttr("disabled").attr("checked",!0),s.find("#MidTermAmount").text(commaSeparator(l?.amount)+" "+langs.irr),s.find("#BillPayButton button").attr("data-payid",l?.paymentID||"")):(s.find("#MidTermAmount").text("0 "+langs.irr),s.find("#MidTermInput").attr("disabled",!0).attr("checked",!1)),n?.amount&&n?.amount!=0?(s.find('label[for="FinalTermInput"]').attr("data-payid",n?.paymentID||""),s.find("#FinalTermAmount").text(commaSeparator(n?.amount)+" "+langs.irr),s.find("#FinalTermInput").removeAttr("disabled")):(s.find("#FinalTermAmount").text("0 "+langs.irr),s.find("#FinalTermInput").attr("disabled",!0)),$("#BillInfoContainer").html(s),e("third-card")}$.validator.addMethod("cellNumber",function(t,e){return this.optional(e)||validateCellNumber(t)},validationMessage.cellNumber),$.validator.addMethod("mciPostPaidNumber",function(t,e){return this.optional(e)||validateMciPostPaidNumber(t)},validationMessage.mciPostPaidNumbers),$.validator.setDefaults({errorElement:"div",errorClass:"uk-text-danger uk-text-small uk-margin-small-top",ignore:".ignore",onkeyup:function(t){this.element(t)},highlight:function(t){$(t).addClass("uk-form-danger")},unhighlight:function(t){$(t).removeClass("uk-form-danger")},errorPlacement:function(t,e){t.appendTo(e.closest("div"))}}),$("#BillForm").validate(),(document.getElementById("BarghBillId")||document.getElementById("WatterBillId")||document.getElementById("GazParticipateCode"))&&$("#BillForm input").rules("add",{digits:!0,minlength:5}),document.getElementById("Phone")&&($("#BillForm input").attr("maxlength","11"),$("#BillForm input").rules("add",{digits:!0,minlength:11})),document.getElementById("Mobile")&&($("#BillForm input").attr("maxlength","11"),$("#BillForm input").rules("add",{digits:!0,cellNumber:!0,minlength:11})),document.getElementById("BillId")&&document.getElementById("PayId")&&($("#BillId").rules("add",{digits:!0,minlength:5}),$("#PayId").rules("add",{digits:!0,minlength:5}),$("#BillId").removeAttr("maxlength")),$(document).on("click",".uk-button, .uk-link",function(n){if(!$(this).hasClass("on-progress")){let r=$(this),o=hasValue(r.attr("data-action"))?r.attr("data-action").trim():null,d=hasValue(r.attr("data-bill-type"))?r.attr("data-bill-type").trim():null;if(o)switch(o){case"showSecondCard":{let s,u;6==d?(u="شناسه قبض",s="پرداخت با شناسه",$("#BillPaymentInput").removeClass("uk-hidden"),$("#BillPaymentInput input").val(""),$("#BillIdInput label").attr("for",billsInputId[d]),$("#BillIdInput input").attr("id",billsInputId[d]).attr("name",billsInputId[d]),$("#BillInquiryButton button").attr("data-action",billsActions[d]).attr("data-bill-type",d)):($("#BillPaymentInput").addClass("uk-hidden"),s=hasValue(d)?`قبض ${billTypesEnum[d]}`:"قبض",$("#BillIdInput label").attr("for",billsInputId[d]),$("#BillIdInput input").attr("id",billsInputId[d]).attr("name",billsInputId[d]),$("#BillInquiryButton button").attr("data-action",billsActions[d]).attr("data-bill-type",d),u=d<=3?"شناسه قبض":hasValue(d)?billLableEnum[d]:"شناسه قبض"),$("#BillFormTitle").text(`${s}`),$("#BillIdInput label").text(`${u}  رو وارد کن`),$("#BillIdInput input").val("").attr("placeholder",u),e("second-card"),$("#BillIdInput input").rules("remove"),4==d?($("#BillIdInput input").attr("maxlength","11"),$("#BillIdInput input").rules("add",{digits:!0,minlength:11})):5==d?($("#BillIdInput input").attr("maxlength","11"),$("#BillIdInput input").rules("add",{digits:!0,cellNumber:!0,minlength:11})):6==d?($("#BillIdInput input").rules("add",{digits:!0,minlength:5}),$("#BillPaymentInput input").rules("add",{digits:!0,minlength:5}),$("#BillIdInput input").removeAttr("maxlength")):($("#BillIdInput input").rules("add",{digits:!0,minlength:5}),$("#BillIdInput input").removeAttr("maxlength")),n.preventDefault();break}case"returnFirstCard":e("first-card"),$("#BillForm").validate().resetForm(),n.preventDefault();break;case"returnSecondCard":e("second-card"),n.preventDefault();break;case"getElectricityBill":if($("#BarghBillId").valid()){let m=$("#BarghBillId").serializeArray();ajaxHandler(t+"/electricity","POST",toCamel(m=hasValue(m)?convertJSON(m):null),null,function(t){if(hasValue(t)&&t.hasOwnProperty("d")&&t?.d?.Status?.IsSuccess)i(toCamel(t.d),d);else{let e=hasValue(t?.d?.Status?.Description)?t.d.Status.Description:langs.serviceException;UIkit.notification(e,{status:"danger",pos:"bottom-center",timeout:7e3})}},!0)}n.preventDefault();break;case"getWaterBill":if($("#WatterBillId").valid()){let p=$("#WatterBillId").serializeArray();ajaxHandler(t+"/water","POST",toCamel(p=hasValue(p)?convertJSON(p):null),null,function(t){if(hasValue(t)&&t.hasOwnProperty("d")&&t?.d?.Status?.IsSuccess)i(toCamel(t.d),d);else{let e=hasValue(t?.d?.Status?.Description)?t.d.Status.Description:langs.serviceException;UIkit.notification(e,{status:"danger",pos:"bottom-center",timeout:7e3})}},!0)}n.preventDefault();break;case"getGasBill":if($("#GazParticipateCode").valid()){let c=$("#GazParticipateCode").serializeArray();ajaxHandler(t+"/gaz","POST",toCamel(c=hasValue(c)?convertJSON(c):null),null,function(t){if(hasValue(t)&&t.hasOwnProperty("d")&&t?.d?.Status?.IsSuccess)i(toCamel(t.d),d);else{let e=hasValue(t?.d?.Status?.Description)?t.d.Status.Description:langs.serviceException;UIkit.notification(e,{status:"danger",pos:"bottom-center",timeout:7e3})}},!0)}n.preventDefault();break;case"getMciBill":if($("#Mobile").valid()){let f=$("#Mobile").serializeArray();if(1!=validateCellNumber(toCamel(f=hasValue(f)?convertJSON(f):null).mobile))return UIkit.notification(messageReFormat(langs.invalidOperatorNumber,langs.mci),{status:"danger",pos:"bottom-center",timeout:7e3}),!1;ajaxHandler(t+"/mci-mobile","POST",toCamel(f),null,function(t){if(hasValue(t)&&t.hasOwnProperty("d")&&t?.d?.Status?.IsSuccess)l(toCamel(t.d),d,f.Mobile);else{let e=hasValue(t?.d?.Status?.Description)?t.d.Status.Description:langs.serviceException;UIkit.notification(e,{status:"danger",pos:"bottom-center",timeout:7e3})}},!0)}n.preventDefault();break;case"getPhoneBill":if($("#Phone").valid()){let b=$("#Phone").serializeArray();if(validateCellNumber(toCamel(b=hasValue(b)?convertJSON(b):null).phone))return UIkit.notification(messageReFormat(langs.invalidOperatorNumber,langs.tci),{status:"danger",pos:"bottom-center",timeout:7e3}),!1;ajaxHandler(t+"/fixed-line","POST",toCamel(b),null,function(t){if(hasValue(t)&&t.hasOwnProperty("d")&&t?.d?.Status?.IsSuccess)l(toCamel(t.d),d,b.Phone);else{let e=hasValue(t?.d?.Status?.Description)?t.d.Status.Description:langs.serviceException;UIkit.notification(e,{status:"danger",pos:"bottom-center",timeout:7e3})}},!0)}n.preventDefault();break;case"getPaperBill":if($("#BillForm").valid()){var I,B,g=$("#BillForm").serializeArray(),g=hasValue(g)?convertJSON(g):null;!1==(B=getBillData(toCamel(I=g).billId,toCamel(I).payId)).verificationBillId?UIkit.notification(langs.invalidBillId,{status:"danger",pos:"bottom-center",timeout:7e3}):!1==B.verificationBillPayment?UIkit.notification(langs.invalidPaymentId,{status:"danger",pos:"bottom-center",timeout:7e3}):!1==B.validationBill?UIkit.notification(langs.invalidBill,{status:"danger",pos:"bottom-center",timeout:7e3}):ajaxHandler(asmxUrl+"/api/v1/bill/get-bill-info","GET",toCamel(I),null,function(t){if(hasValue(t=toCamel(t))&&t.isSuccess){if(!t.data.billAmount||0===t.data.billAmount){UIkit.notification(langs.noBillDebt,{status:"danger",pos:"bottom-center",timeout:7e3});return}let i=hasValue(t.data?.billType)?t.data?.billType:"قبض",l=hasValue(t.data?.billTypeId)?t.data?.billTypeId:null,n=t?.data?.billId?.toString().trim()||"",r=t?.data?.payId?.toString().trim()||"",o=t?.data?.billAmount?.toString().trim()||"";$("#BillInfoTitle").text(`${i}`);let d=$($("#BillInfoTemplate").html());d.find("#BillName").text(`${i}`),d.find("#BillInfoId").text(`شناسه قبض: ${n}`),d.find("#BillAmount").text(commaSeparator(o)+" "+langs.irr),d.find(".ui-bill-amount-icon img").attr("src",`../dist/ui/img/icon/app/${billsIcons[l]?billsIcons[l]:"ic-paper-bill"}.svg`),d.find("#BillPayButton button").attr("data-billid",n).attr("data-payid",r),$("#BillInfoContainer").html(d),a(t.data,d),e("third-card")}else{let s=hasValue(t?.status?.description)?t.status.description:langs.serviceException;UIkit.notification(s,{status:"danger",pos:"bottom-center",timeout:7e3})}},!0)}n.preventDefault();break;case"payBill":{let y=hasValue(r.attr("data-billid"))?r.attr("data-billid").trim():null,v=hasValue(r.attr("data-payid"))?r.attr("data-payid").trim():null;if(y&&v){let h={billId:y,payId:v,ThirdPartyCallBack:ThirdPartyCallBackUrl};ajaxHandler("http://localhost:43197/api/v1/bill/get-token","GET",h,null,function(t){if(t&&t.IsSuccess&&t.Data){let{IpgUrl:e,Token:a}=t.Data;$.redirect(e,{token:a,GetMethod:!0},"POST")}else UIkit.notification(langs.serviceException,{status:"danger",pos:"bottom-center",timeout:7e3})},!0,!0,!0)}n.preventDefault();break}case"selectPhoneBill":{let D=hasValue(r.attr("data-payid"))?r.attr("data-payid").trim():null;D&&$("#BillPayButton button").attr("data-payid",D);break}case"toggleBillDetails":$(".ui-bills-details").slideToggle(500)}}})});