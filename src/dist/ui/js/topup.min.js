"use strict";$(document).ready(function(){let e;function t(e){$(".ui-card-wizard").hide(),$(`.ui-card-wizard[data-wizard="${e}"]`).fadeIn()}function a(e,t){var a=e.ChargeType,r=t.ChargeType;return a<r?-1:a>r?1:0}function r(){$("#TopupOperator").children().find("a").removeClass("ui-active-operator")}$.validator.addMethod("cellNumber",function(e,t){return this.optional(t)||validateCellNumber(e)},validationMessage.cellNumber),$.validator.addMethod("mciPostPaidNumber",function(e,t){return this.optional(t)||validateMciPostPaidNumber(e)},validationMessage.mciPostPaidNumbers),$.validator.setDefaults({errorElement:"div",errorClass:"uk-text-danger uk-text-small uk-margin-small-top",ignore:".ignore",onkeyup:function(e){this.element(e)},highlight:function(e){$(e).addClass("uk-form-danger")},unhighlight:function(e){$(e).removeClass("uk-form-danger")},errorPlacement:function(e,t){e.appendTo(t.closest("div"))}}),document.getElementById("TopupNumber")&&(ajaxHandler(asmxUrl+"/controllers/eChargeController.asmx/getOperators","GET",null,null,function(e){if(hasValue(e)&&e.hasOwnProperty("d")&&hasValue(e.d)){let t="";$.each(e.d,function(e,a){let r="./dist/ui/img/icon/operators/"+operatorIcons[a.Code]+".svg";t+=$("#Operators").html().replace("%Code%",a.Code).replace("%IconSrc%",r).replaceAll("%Name%",a.Description)}),$("#TopupOperator ul").empty().append(t),$('button[data-action="getTopupPackage"]').removeClass("uk-hidden")}else $("#TopupOperator").empty().append($("#ServiceError").html())},!0),$("#TopupNumber").validate({rules:{CellNumber:{digits:!0,cellNumber:!0}}}),$("#TopupNumber #CellNumber").keyup(function(t){let a=normalize($(this).val());if(a.length>=4){if(e=validateCellNumber(a,!0)){let o=$("#TopupOperator").children().find("[data-value="+e+"]");o.hasClass("ui-active-operator")||($("#Operator").val(e),r(),o.addClass("ui-active-operator"))}}else a.length<4&&($("#Operator").val(""),r(),$("#NormalTopup ul").empty(),$("#AmazingTopup ul").empty())})),$(document).on("click",".uk-button, .uk-link",function(e){if(!$(this).hasClass("on-progress")){let o=$(this),l=hasValue($(this).attr("data-action"))?$(this).attr("data-action").trim():null;if(l)switch(l){case"changeTopupOperator":{let i=hasValue($("#CellNumber").val())?normalize($("#CellNumber").val().trim()):null;if($("#TopupNumber").valid()){let u=hasValue($(this).attr("data-value"))?$(this).attr("data-value").trim():null;$("#Operator").val(u),r(),o.addClass("ui-active-operator")}else if(!i||!validateCellNumber(i))return UIkit.notification(i?langs.invalidCellNumber:langs.requiredCellNumber,{status:"primary",pos:"bottom-center",timeout:7e3}),!1;e.preventDefault();break}case"buyTopupPackage":{let n=hasValue($("#CellNumber").val())?normalize($("#CellNumber").val().trim()):null,p=null,c=null,s=0,d=null,m=document.querySelector("#TopupPackageSwitcher > .uk-active"),g=m?.querySelector("li.uk-active");if(g&&(p=g.getAttribute("data-operator")||null,c=g.getAttribute("data-charge")||null,s=normalize(g.getAttribute("data-amount")||"")||null,d=g.getAttribute("data-text")||null),p&&c&&d&&n&&s){let h={CellNumber:n,ChargeCode:c,ChargeOperatorCode:p,ChargeDescription:d,Amount:s,TopUpType:"Charge",ThirdPartyCallBack:ThirdPartyCallBackUrl};ajaxHandler(asmxUrl+"/api/v1/ipg-top-up/get-token","GET",h,null,function(e){if(e&&e.IsSuccess&&e.Data){let{IpgUrl:t,GetMethod:a,Value:r,ResNum:o}=e.Data;$.redirect(t,{token:r,GetMethod:!0},"POST")}else UIkit.notification(langs.serviceException,{status:"danger",pos:"bottom-center",timeout:7e3})},!0,!0,!0)}else UIkit.notification(langs.selectingTopupPackage,{status:"danger",pos:"bottom-center",timeout:7e3});e.preventDefault();break}case"getTopupPackage":$("#TopupNumber").valid()&&function e(){let r=hasValue($("#Operator").val())?$("#Operator").val().trim():null,o=hasValue($("#TopupPackageSwitcher").attr("data-operator"))?$("#TopupPackageSwitcher").attr("data-operator").trim():null;if(o===r)return t("second-card");ajaxHandler(asmxUrl+"/controllers/eChargeController.asmx/getNormalPackages","GET",{chargeOperatorCode:r},null,function(e){if(!(hasValue(e)&&e.hasOwnProperty("d")))return UIkit.notification(langs.serviceException,{status:"danger",pos:"bottom-center",timeout:7e3});if(!hasValue(e.d))return UIkit.notification(langs.topupNoMatchFound,{status:"primary",pos:"bottom-center",timeout:7e3});{let o="",l="",i=3==r?langs.topupExcitingPkg:langs.topupAmazingPkg,u=e.d;u.length&&($.each(u.sort(a),function(e,t){if(hasValue(t.Amount)){let a=0==t.ChargeType?langs.topupNormalPkg:i,u=$("#Packages").html().replace("%Operator%",r).replaceAll("%Code%",t.SepChargeCode).replace("%OperatorName%",operatorTypes[r]).replaceAll("%Type%",a).replaceAll("%Description%",commaSeparator(hasValue(t.AmountWithoutVAT)?t.AmountWithoutVAT:t.Amount)).replace("%ChargeAmount%",t.Amount);1==t.ChargeType?l+=u:o+=u}}),$("#TopupPackageSwitcher").attr("data-operator",r),$("#NormalTopup ul").empty().append(o),$("#AmazingTopup ul").empty().append(l)),l.length?($(".ui-topup-type-title").removeClass("uk-hidden"),$("#ValTopupType").text(i)):$(".ui-topup-type-title").addClass("uk-hidden"),t("second-card")}},!0)}(),e.preventDefault();break;case"returnFirstCard":t("first-card"),e.preventDefault()}}})});